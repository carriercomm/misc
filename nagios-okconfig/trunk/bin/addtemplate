#!/bin/sh


TEMPLATE_DIR=/etc/nagios/examples/nagios/
DEST_DIRECTORY=`pwd`

print_help() {
      echo "addtemplate version $VERSION"
      echo "Usage: $0 <--host host> <--template template>"
      echo ""
      echo "Example: Add a new windows host"
      echo "# addtemplate --host myhostname --template cisco"
}

if [ $# -eq 0 ]; then
     print_help ;
     exit 0
fi


# Parse arguments
while [ $# -gt 0 ]
do
  case $1
  in
    --host)
      hostname=$2
      shift 2
    ;;

    --force)
	FORCE=yes
	shift 1
    ;;


    --template)
	template=$2
	shift 2;
    ;;
    --help)
	print_help;
	exit 0;
    ;;
    *)
	print_help;
	exit 1;
    ;;
  esac
done

DESTINATION="$DEST_DIRECTORY/$hostname-$template.cfg"
TEMPLATE=$TEMPLATE_DIR/$template.cfg-example
if [ ! -f "$TEMPLATE" ]; then
	echo "ERROR: No such file or directory: $TEMPLATE"
	exit 1
fi

if [ -z "$FORCE" ]; then
        if [ -f $DESTINATION ]; then
                echo "ERROR: File $DESTINATION already exists. Use --force to overwrite"
                exit 1
        fi
fi



cat $TEMPLATE | sed "s/IPADDR/$ipaddress/g" | sed "s/HOSTNAME/$hostname/g" > $DESTINATION
echo "Template $template successfully added to host $hostname"
grep TODO $TEMPLATE

#echo "* hostname = $hostname"
#echo "* ipaddress = $ipaddress"
#echo "* configaddress = $DESTINATION"
#echo "* template = $template"



